<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Naranjo ADR Assessor (Local AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body { font-family: 'Inter', sans-serif; }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      @media print {
        @page { size: auto; margin: 0mm; }
        body * { visibility: hidden; }
        #root { display: block; }
        .printable-card-container, .printable-card-container * { visibility: visible !important; }
        .printable-card-container {
          position: absolute; left: 50%; top: 50%;
          transform: translate(-50%, -50%);
          display: flex !important; width: 100%; height: 100vh;
          justify-content: center; align-items: center;
          margin: 0; padding: 0; background-color: white;
        }
      }
      /* Animation for AI Loading */
      .pulse-ring {
        animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
      }
      @keyframes pulse-ring {
        0% { transform: scale(0.33); }
        80%, 100% { opacity: 0; }
      }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
  }
}
</script>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useMemo, useRef } from 'react';
      import ReactDOM from 'react-dom/client';
      import { 
        Plus, Trash2, Clock, Printer, FileCheck, Pill, BookOpen, Check, X, 
        HelpCircle, User, FileDigit, Building2, CalendarDays, UserCog, CreditCard, 
        History, AlertCircle, RefreshCw, Sparkles, BrainCircuit, AlertTriangle, Stethoscope
      } from 'lucide-react';

      // --- TYPES ---
      enum Interpretation {
        DEFINITE = "Definite",
        PROBABLE = "Probable",
        POSSIBLE = "Possible",
        DOUBTFUL = "Doubtful",
      }

      interface Question {
        id: number;
        text: string;
        yesScore: number;
        noScore: number;
        dontKnowScore: number;
      }

      type AnswerValue = 'Yes' | 'No' | 'DontKnow' | null;

      interface AssessmentState {
        [key: number]: AnswerValue;
      }

      interface HistoryItem {
        id: string;
        drugName: string;
        symptoms: string;
        reactionDate?: string;
      }

      interface PatientDetails {
        fullName: string;
        hn: string;
        unit: string;
        date: string;
        pharmacistName: string;
        licenseNo: string;
        history: HistoryItem[];
      }

      interface ReportData {
        drugName: string;
        reactionDescription: string;
        totalScore: number;
        interpretation: Interpretation;
        answers: { questionId: number; answer: AnswerValue; score: number }[];
        language: Language;
        patientDetails?: PatientDetails;
      }

      interface AIAnalysisResult {
        analysis: string;
        recommendations: string[];
        riskFactor: 'Low' | 'Medium' | 'High' | 'Unknown';
      }

      type Language = 'th' | 'en' | 'lo' | 'my';

      interface Translation {
        title: string;
        subtitle: string;
        role: string;
        headerPatient: string;
        labelName: string;
        labelHN: string;
        labelUnit: string;
        labelDate: string;
        labelPharmacist: string;
        labelLicense: string;
        headerHistory: string;
        subHistory: string;
        labelHistoryDrug: string;
        labelHistorySymptoms: string;
        labelHistoryDate: string;
        btnAdd: string;
        noHistoryAdded: string;
        headerCurrentEvent: string;
        drugLabel: string;
        drugPlaceholder: string;
        reactionLabel: string;
        reactionPlaceholder: string;
        questionsHeader: string;
        answered: string;
        viewResults: string;
        completeAll: string;
        scoreTitle: string;
        classification: string;
        drug: string;
        event: string;
        reset: string;
        yes: string;
        no: string;
        dontKnow: string;
        interpretations: { definite: string; probable: string; possible: string; doubtful: string; };
        cardTitle: string;
        cardTableDrug: string;
        cardTableSymptom: string;
        cardTableDate: string;
        cardTableResult: string;
        cardHistoryLabel: string;
        cardFooterWarning: string;
        cardFooterWarningEn: string;
        printCardBtn: string;
        printReportBtn: string;
        assessor: string;
        guidelineBtn: string;
        // AI Specific
        analyzeBtn: string;
        analyzing: string;
        aiError: string;
        riskLevel: string;
        recommendations: string;
        aiDisclaimer: string;
        riskFactors: { Low: string; Medium: string; High: string; Unknown: string; };
      }

      // --- CONSTANTS ---
      const BASE_SCORES = [
        { id: 1, yes: 1, no: 0, dk: 0 },
        { id: 2, yes: 2, no: -1, dk: 0 },
        { id: 3, yes: 1, no: 0, dk: 0 },
        { id: 4, yes: 2, no: -1, dk: 0 },
        { id: 5, yes: -1, no: 2, dk: 0 },
        { id: 6, yes: -1, no: 1, dk: 0 },
        { id: 7, yes: 1, no: 0, dk: 0 },
        { id: 8, yes: 1, no: 0, dk: 0 },
        { id: 9, yes: 1, no: 0, dk: 0 },
        { id: 10, yes: 1, no: 0, dk: 0 },
      ];

      const QUESTIONS_BY_LANG: Record<Language, Question[]> = {
        th: [
          "à¹€à¸„à¸¢à¸¡à¸µà¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸£à¸¸à¸›à¹à¸™à¹ˆà¸Šà¸±à¸”à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¸­à¸²à¸à¸²à¸£à¸™à¸µà¹‰à¸¡à¸²à¸à¹ˆà¸­à¸™à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¹„à¸”à¹‰à¸£à¸±à¸šà¸¢à¸²à¸—à¸µà¹ˆà¸ªà¸‡à¸ªà¸±à¸¢à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¸”à¸µà¸‚à¸¶à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¸«à¸¢à¸¸à¸”à¸¢à¸² à¸«à¸£à¸·à¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸¢à¸²à¸•à¹‰à¸²à¸™à¸ˆà¸³à¹€à¸žà¸²à¸°à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¸à¸¥à¸±à¸šà¸¡à¸²à¹€à¸›à¹‡à¸™à¸‹à¹‰à¸³à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸¢à¸²à¹€à¸”à¸´à¸¡à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸¡à¸µà¸ªà¸²à¹€à¸«à¸•à¸¸à¸­à¸·à¹ˆà¸™ (à¸™à¸­à¸à¸ˆà¸²à¸à¸¢à¸²) à¸—à¸µà¹ˆà¸­à¸˜à¸´à¸šà¸²à¸¢à¸­à¸²à¸à¸²à¸£à¸™à¸µà¹‰à¹„à¸”à¹‰à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¸à¸³à¹€à¸£à¸´à¸šà¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸¢à¸²à¸«à¸¥à¸­à¸ (Placebo) à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸•à¸£à¸§à¸ˆà¸žà¸šà¸£à¸°à¸”à¸±à¸šà¸¢à¸²à¹ƒà¸™à¹€à¸¥à¸·à¸­à¸” (à¸«à¸£à¸·à¸­à¸ªà¸²à¸£à¸„à¸±à¸”à¸«à¸¥à¸±à¹ˆà¸‡) à¹ƒà¸™à¸£à¸°à¸”à¸±à¸šà¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸žà¸´à¸©à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¸£à¸¸à¸™à¹à¸£à¸‡à¸‚à¸¶à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¸™à¸²à¸”à¸¢à¸² à¸«à¸£à¸·à¸­à¸¥à¸”à¸¥à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸¥à¸”à¸‚à¸™à¸²à¸”à¸¢à¸²à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¹€à¸„à¸¢à¸¡à¸µà¸­à¸²à¸à¸²à¸£à¸„à¸¥à¹‰à¸²à¸¢à¸à¸±à¸™à¸à¸±à¸šà¸¢à¸²à¸•à¸±à¸§à¹€à¸”à¸´à¸¡à¸«à¸£à¸·à¸­à¸¢à¸²à¸—à¸µà¹ˆà¸„à¸¥à¹‰à¸²à¸¢à¸à¸±à¸™à¹ƒà¸™à¸­à¸”à¸µà¸•à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?",
          "à¸­à¸²à¸à¸²à¸£à¹„à¸¡à¹ˆà¸žà¸¶à¸‡à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸¢à¸·à¸™à¸¢à¸±à¸™à¸”à¹‰à¸§à¸¢à¸«à¸¥à¸±à¸à¸à¸²à¸™à¹€à¸Šà¸´à¸‡à¸›à¸£à¸°à¸ˆà¸±à¸à¸©à¹Œà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?"
        ].map((text, idx) => ({ id: idx + 1, text, yesScore: BASE_SCORES[idx].yes, noScore: BASE_SCORES[idx].no, dontKnowScore: BASE_SCORES[idx].dk })),
        en: [
          "Are there previous conclusive reports on this reaction?",
          "Did the adverse event appear after the suspected drug was administered?",
          "Did the adverse reaction improve when the drug was discontinued or a specific antagonist was administered?",
          "Did the adverse reaction reappear when the drug was re-administered?",
          "Are there alternative causes (other drugs or underlying disease) that could on their own have caused the reaction?",
          "Did the reaction reappear when a placebo was given?",
          "Was the drug detected in the blood (or other fluids) in concentrations known to be toxic?",
          "Was the reaction more severe when the dose was increased or less severe when the dose was decreased?",
          "Did the patient have a similar reaction to the same or similar drugs in any previous exposure?",
          "Was the adverse event confirmed by any objective evidence?"
        ].map((text, idx) => ({ id: idx + 1, text, yesScore: BASE_SCORES[idx].yes, noScore: BASE_SCORES[idx].no, dontKnowScore: BASE_SCORES[idx].dk })),
        lo: [
          "àº¡àºµàº¥àº²àºàº‡àº²àº™àº—àºµà»ˆàºŠàº±àº”à»€àºˆàº™àºà»ˆàº½àº§àºàº±àºšàº›àº°àº•àº´àºàº´àº¥àº´àºàº²àº™àºµà»‰àº¡àº²àºà»ˆàº­àº™àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™à»€àºàºµàº”àº‚àº¶à»‰àº™àº«àº¼àº±àº‡àºˆàº²àºà»„àº”à»‰àº®àº±àºšàº¢àº²àº—àºµà»ˆàºªàº»àº‡à»„àºªà»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™àº”àºµàº‚àº¶à»‰àº™à»€àº¡àº·à»ˆàº­àº¢àº¸àº”àº¢àº² àº«àº¼àº· à»„àº”à»‰àº®àº±àºšàº¢àº²à»àºà»‰àºžàº´àº”àºªàº°à»€àºžàº²àº°à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™àºàº±àºšàº¡àº²à»€àº›àº±àº™àº­àºµàºà»€àº¡àº·à»ˆàº­à»„àº”à»‰àº®àº±àºšàº¢àº²à»€àº”àºµàº¡àºŠà»‰àº³à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àº¡àºµàºªàº²à»€àº«àº”àº­àº·à»ˆàº™ (àº™àº­àºàºˆàº²àºàº¢àº²) àº—àºµà»ˆàº­àº°àº—àº´àºšàº²àºàº­àº²àºàº²àº™àº™àºµà»‰à»„àº”à»‰àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™àºàº±àºšàº¡àº²à»€àº›àº±àº™àº­àºµàºà»€àº¡àº·à»ˆàº­à»„àº”à»‰àº®àº±àºšàº¢àº²àº«àº¼àº­àº (Placebo) à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àºàº§àº”àºžàº»àºšàº¥àº°àº”àº±àºšàº¢àº²à»ƒàº™à»€àº¥àº·àº­àº” (àº«àº¼àº· àºªàº²àº™àº„àº±àº”àº«àº¼àº±à»ˆàº‡) à»ƒàº™àº¥àº°àº”àº±àºšàº—àºµà»ˆà»€àº›àº±àº™àºžàº´àº”à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™àº®àº¸àº™à»àº®àº‡àº‚àº¶à»‰àº™à»€àº¡àº·à»ˆàº­à»€àºžàºµà»ˆàº¡àº‚àº°à»œàº²àº”àº¢àº² àº«àº¼àº· àº«àº¼àº¸àº”àº¥àº»àº‡à»€àº¡àº·à»ˆàº­àº«àº¼àº¸àº”àº‚àº°à»œàº²àº”àº¢àº²à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àºœàº¹à»‰àº›à»ˆàº§àºà»€àº„àºµàºàº¡àºµàº­àº²àºàº²àº™àº„à»‰àº²àºàº„àº·àºàº±àº™àºàº±àºšàº¢àº²àº•àº»àº§à»€àº”àºµàº¡ àº«àº¼àº· àº¢àº²àº—àºµà»ˆàº„à»‰àº²àºàº„àº·àºàº±àº™à»ƒàº™àº­àº°àº”àºµàº”à»àº¡à»ˆàº™àºšà»à»ˆ?",
          "àº­àº²àºàº²àº™àºšà»à»ˆàºžàº¶àº‡àº›àº°àºªàº»àº‡à»„àº”à»‰àº®àº±àºšàºàº²àº™àº¢àº·àº™àº¢àº±àº™àº”à»‰àº§àºàº«àº¼àº±àºàº–àº²àº™àº—àºµà»ˆàºŠàº±àº”à»€àºˆàº™à»àº¡à»ˆàº™àºšà»à»ˆ?"
        ].map((text, idx) => ({ id: idx + 1, text, yesScore: BASE_SCORES[idx].yes, noScore: BASE_SCORES[idx].no, dontKnowScore: BASE_SCORES[idx].dk })),
        my: [
          "á€¤á€á€¯á€¶á€·á€•á€¼á€”á€ºá€™á€¾á€¯á€”á€¾á€„á€·á€ºá€•á€á€ºá€žá€€á€ºá á€šá€á€„á€ºá€€ á€¡á€á€­á€¡á€€á€» á€¡á€…á€®á€›á€„á€ºá€á€¶á€…á€¬á€™á€»á€¬á€¸ á€›á€¾á€­á€•á€«á€žá€œá€¬á€¸á‹",
          "á€žá€¶á€žá€šá€›á€¾á€­á€žá€±á€¬á€†á€±á€¸á€€á€­á€¯ á€žá€±á€¬á€€á€ºá€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€†á€­á€¯á€¸á€›á€½á€¬á€¸á€žá€±á€¬á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€•á€±á€«á€ºá€œá€¬á€•á€«á€žá€œá€¬á€¸á‹",
          "á€†á€±á€¸á€›á€•á€ºá€œá€­á€¯á€€á€ºá€žá€±á€¬á€¡á€á€« á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º á€–á€¼á€±á€†á€±á€¸á€•á€±á€¸á€žá€±á€¬á€¡á€á€« á€žá€€á€ºá€žá€¬á€žá€½á€¬á€¸á€•á€«á€žá€œá€¬á€¸á‹",
          "á€†á€±á€¸á€€á€­á€¯ á€•á€¼á€”á€ºá€œá€Šá€ºá€•á€±á€¸á€žá€±á€¬á€¡á€á€« á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€•á€¼á€”á€ºá€•á€±á€«á€ºá€œá€¬á€•á€«á€žá€œá€¬á€¸á‹",
          "á€¤á€œá€€á€¹á€á€á€¬á€€á€­á€¯ á€–á€¼á€…á€ºá€…á€±á€”á€­á€¯á€„á€ºá€žá€±á€¬ á€¡á€á€¼á€¬á€¸á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€›á€„á€ºá€¸á€™á€»á€¬á€¸ (á€¡á€á€¼á€¬á€¸á€†á€±á€¸ á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º á€›á€±á€¬á€‚á€«) á€›á€¾á€­á€•á€«á€žá€œá€¬á€¸á‹",
          "á€†á€±á€¸á€á€«á€¸á€¡á€á€¯ (Placebo) á€•á€±á€¸á€žá€±á€¬á€¡á€á€« á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€•á€¼á€”á€ºá€•á€±á€«á€ºá€œá€¬á€•á€«á€žá€œá€¬á€¸á‹",
          "á€žá€½á€±á€¸á€‘á€²á€á€½á€„á€º (á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º á€¡á€á€¼á€¬á€¸á€¡á€›á€Šá€ºá€™á€»á€¬á€¸) á€¡á€†á€­á€•á€ºá€–á€¼á€…á€ºá€…á€±á€”á€­á€¯á€„á€ºá€žá€±á€¬ á€•á€™á€¬á€á€¡á€‘á€­ á€†á€±á€¸á€á€«á€¸á€€á€­á€¯ á€á€½á€±á€·á€›á€¾á€­á€›á€•á€«á€žá€œá€¬á€¸á‹",
          "á€†á€±á€¸á€•á€™á€¬á€á€á€­á€¯á€¸á€žá€±á€¬á€¡á€á€« á€•á€­á€¯á€†á€­á€¯á€¸á€œá€¬á€•á€¼á€®á€¸áŠ á€œá€»á€¾á€±á€¬á€·á€žá€±á€¬á€¡á€á€« á€žá€€á€ºá€žá€¬á€•á€«á€žá€œá€¬á€¸á‹",
          "á€œá€°á€”á€¬á€žá€Šá€º á€šá€á€„á€ºá€€ á€¤á€†á€±á€¸ á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º á€†á€„á€ºá€á€°á€žá€±á€¬á€†á€±á€¸á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€¡á€œá€¬á€¸á€á€°á€–á€¼á€…á€ºá€–á€°á€¸á€•á€«á€žá€œá€¬á€¸á‹",
          "á€†á€­á€¯á€¸á€›á€½á€¬á€¸á€žá€±á€¬á€–á€¼á€…á€ºá€›á€•á€ºá€€á€­á€¯ á€“á€™á€¹á€™á€“á€­á€‹á€¹á€Œá€¬á€”á€ºá€€á€»á€žá€±á€¬ á€žá€€á€ºá€žá€±á€¡á€‘á€±á€¬á€€á€ºá€¡á€‘á€¬á€¸á€–á€¼á€„á€·á€º á€¡á€á€Šá€ºá€•á€¼á€¯á€”á€­á€¯á€„á€ºá€•á€«á€žá€œá€¬á€¸á‹"
        ].map((text, idx) => ({ id: idx + 1, text, yesScore: BASE_SCORES[idx].yes, noScore: BASE_SCORES[idx].no, dontKnowScore: BASE_SCORES[idx].dk })),
      };

      const TRANSLATIONS: Record<Language, Translation> = {
        th: {
          title: "Naranjo AI Assessor - Warinchamrab Hospital",
          subtitle: "à¹à¸šà¸šà¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸­à¸²à¸à¸²à¸£à¹„à¸¡à¹ˆà¸žà¸¶à¸‡à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œà¸ˆà¸²à¸à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸¢à¸² (Local AI)",
          role: "à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸ à¸ªà¸±à¸Šà¸à¸£",
          headerPatient: "1 à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢",
          labelName: "à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥",
          labelHN: "HN",
          labelUnit: "à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸›à¸£à¸°à¹€à¸¡à¸´à¸™",
          labelDate: "à¸§à¸±à¸™à¸—à¸µà¹ˆ",
          labelPharmacist: "à¹€à¸ à¸ªà¸±à¸Šà¸à¸£à¸œà¸¹à¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™",
          labelLicense: "à¹€à¸¥à¸‚à¹ƒà¸šà¸›à¸£à¸°à¸à¸­à¸šà¸¯ (à¸ .)",
          headerHistory: "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹à¸žà¹‰à¸¢à¸²à¹€à¸”à¸´à¸¡ (History)",
          subHistory: "à¹€à¸žà¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸¢à¸²à¸—à¸µà¹ˆà¸—à¸£à¸²à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¹à¸žà¹‰à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§ (à¸£à¸°à¸šà¸¸à¹€à¸›à¹‡à¸™à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¹€à¸à¹ˆà¸² H)",
          labelHistoryDrug: "à¸Šà¸·à¹ˆà¸­à¸¢à¸²",
          labelHistorySymptoms: "à¸­à¸²à¸à¸²à¸£",
          labelHistoryDate: "à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸žà¹‰ (à¸–à¹‰à¸²à¸—à¸£à¸²à¸š)",
          btnAdd: "+ à¹€à¸žà¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£",
          noHistoryAdded: "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸£à¸²à¸¢à¸à¸²à¸£à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹à¸žà¹‰à¸¢à¸²",
          headerCurrentEvent: "2 à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸¢à¸²à¸—à¸µà¹ˆà¸ªà¸‡à¸ªà¸±à¸¢ (Suspected Drug Assessment)",
          drugLabel: "à¸Šà¸·à¹ˆà¸­à¸¢à¸²à¸—à¸µà¹ˆà¸ªà¸‡à¸ªà¸±à¸¢",
          drugPlaceholder: "à¹€à¸Šà¹ˆà¸™ Amoxicillin",
          reactionLabel: "à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸­à¸²à¸à¸²à¸£à¹„à¸¡à¹ˆà¸žà¸¶à¸‡à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ",
          reactionPlaceholder: "à¹€à¸Šà¹ˆà¸™ à¸œà¸·à¹ˆà¸™à¹à¸”à¸‡ à¸„à¸±à¸™",
          questionsHeader: "à¸„à¸³à¸–à¸²à¸¡à¸›à¸£à¸°à¹€à¸¡à¸´à¸™ Naranjo",
          answered: "à¸•à¸­à¸šà¹à¸¥à¹‰à¸§",
          viewResults: "à¸”à¸¹à¸œà¸¥à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ",
          completeAll: "à¸à¸£à¸¸à¸“à¸²à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡à¹ƒà¸«à¹‰à¸„à¸£à¸šà¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œ",
          scoreTitle: "à¸„à¸°à¹à¸™à¸™à¸„à¸§à¸²à¸¡à¸™à¹ˆà¸²à¸ˆà¸°à¹€à¸›à¹‡à¸™",
          classification: "à¸à¸²à¸£à¹à¸›à¸¥à¸œà¸¥",
          drug: "à¸¢à¸²",
          event: "à¸­à¸²à¸à¸²à¸£",
          reset: "à¹€à¸£à¸´à¹ˆà¸¡à¸à¸²à¸£à¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¹ƒà¸«à¸¡à¹ˆ",
          yes: "à¹ƒà¸Šà¹ˆ",
          no: "à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ",
          dontKnow: "à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸š",
          interpretations: {
            definite: "à¹ƒà¸Šà¹ˆà¹à¸™à¹ˆà¸™à¸­à¸™ (Definite)",
            probable: "à¸™à¹ˆà¸²à¸ˆà¸°à¹ƒà¸Šà¹ˆ (Probable)",
            possible: "à¸­à¸²à¸ˆà¸ˆà¸°à¹ƒà¸Šà¹ˆ (Possible)",
            doubtful: "à¸™à¹ˆà¸²à¸ªà¸‡à¸ªà¸±à¸¢ (Doubtful)"
          },
          cardTitle: "à¸šà¸±à¸•à¸£à¹à¸žà¹‰à¸¢à¸² (Drug Allergy Card)",
          cardTableDrug: "à¸¢à¸²à¸—à¸µà¹ˆà¹à¸žà¹‰ (Drug Name)",
          cardTableSymptom: "à¸­à¸²à¸à¸²à¸£ (Symptoms)",
          cardTableDate: "à¸§à¸±à¸™à¸—à¸µà¹ˆ (Date)",
          cardTableResult: "à¸œà¸¥à¸›à¸£à¸°à¹€à¸¡à¸´à¸™ (Result)",
          cardHistoryLabel: "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¹€à¸à¹ˆà¸² (H)",
          cardFooterWarning: "à¹‚à¸›à¸£à¸”à¹à¸ªà¸”à¸‡à¸šà¸±à¸•à¸£à¸™à¸µà¹‰à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£",
          cardFooterWarningEn: "Please show this card every visit.",
          printCardBtn: "à¸žà¸´à¸¡à¸žà¹Œà¸šà¸±à¸•à¸£à¹à¸žà¹‰à¸¢à¸²",
          printReportBtn: "à¸žà¸´à¸¡à¸žà¹Œà¸£à¸²à¸¢à¸‡à¸²à¸™à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡ (A4)",
          assessor: "à¸œà¸¹à¹‰à¸›à¸£à¸°à¹€à¸¡à¸´à¸™",
          guidelineBtn: "à¹à¸™à¸§à¸—à¸²à¸‡à¸›à¸à¸´à¸šà¸±à¸•à¸´ ADR",
          // AI
          analyzeBtn: "à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸œà¸¥à¸—à¸²à¸‡à¸„à¸¥à¸´à¸™à¸´à¸à¸”à¹‰à¸§à¸¢ AI (Local)",
          analyzing: "à¸à¸³à¸¥à¸±à¸‡à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥...",
          aiError: "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Ollama à¹„à¸”à¹‰",
          riskLevel: "à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡",
          recommendations: "à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸ˆà¸²à¸ AI",
          aiDisclaimer: "à¸„à¸³à¹€à¸•à¸·à¸­à¸™: à¸œà¸¥à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸ˆà¸²à¸ AI à¹ƒà¸Šà¹‰à¹€à¸žà¸·à¹ˆà¸­à¸›à¸£à¸°à¸à¸­à¸šà¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¹‚à¸›à¸£à¸”à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸²à¸‡à¸„à¸¥à¸´à¸™à¸´à¸à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡ (Ollama Model)",
          riskFactors: { Low: "à¸•à¹ˆà¸³", Medium: "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡", High: "à¸ªà¸¹à¸‡", Unknown: "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸" }
        },
        en: {
          title: "Naranjo AI Assessor - Warinchamrab Hospital",
          subtitle: "ADR Probability Scale & Assessment (Local AI)",
          role: "Clinical Pharmacist Tool",
          headerPatient: "1 Patient Information",
          labelName: "Name-Surname",
          labelHN: "HN",
          labelUnit: "Assessing Unit",
          labelDate: "Date",
          labelPharmacist: "Assessing Pharmacist",
          labelLicense: "License No.",
          headerHistory: "History of Drug Allergy",
          subHistory: "Add known drug allergies (indicate H for historical records)",
          labelHistoryDrug: "Drug Name",
          labelHistorySymptoms: "Symptoms",
          labelHistoryDate: "Date (if known)",
          btnAdd: "+ Add",
          noHistoryAdded: "No history added yet",
          headerCurrentEvent: "2 Suspected Drug Assessment",
          drugLabel: "Suspected Drug Name",
          drugPlaceholder: "e.g., Amoxicillin",
          reactionLabel: "Adverse Event Description",
          reactionPlaceholder: "e.g., Maculopapular rash",
          questionsHeader: "Naranjo Assessment Questions",
          answered: "Answered",
          viewResults: "View Results Analysis",
          completeAll: "Complete all questions to unlock analysis",
          scoreTitle: "Probability Score",
          classification: "Classification",
          drug: "Drug",
          event: "Event",
          reset: "Start New Assessment",
          yes: "Yes",
          no: "No",
          dontKnow: "Unk",
          interpretations: {
            definite: "Definite ADR",
            probable: "Probable ADR",
            possible: "Possible ADR",
            doubtful: "Doubtful ADR"
          },
          cardTitle: "Drug Allergy Card",
          cardTableDrug: "Drug Name",
          cardTableSymptom: "Symptoms",
          cardTableDate: "Date",
          cardTableResult: "Result",
          cardHistoryLabel: "History (H)",
          cardFooterWarning: "à¹‚à¸›à¸£à¸”à¹à¸ªà¸”à¸‡à¸šà¸±à¸•à¸£à¸™à¸µà¹‰à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£",
          cardFooterWarningEn: "Please show this card every visit.",
          printCardBtn: "Print Allergy Card",
          printReportBtn: "Print Full Report (A4)",
          assessor: "Assessor",
          guidelineBtn: "ADR Guidelines",
          // AI
          analyzeBtn: "Clinical AI Analysis (Local)",
          analyzing: "Analyzing...",
          aiError: "Connection to Ollama failed",
          riskLevel: "Risk Level",
          recommendations: "AI Recommendations",
          aiDisclaimer: "Disclaimer: AI analysis is for decision support only. Please verify with clinical judgment. (Ollama Model)",
          riskFactors: { Low: "Low", Medium: "Medium", High: "High", Unknown: "Unknown" }
        },
        lo: {
          title: "Naranjo AI Assessor - Warinchamrab Hospital",
          subtitle: "à»àºšàºšàº›àº°à»€àº¡àºµàº™àºœàº»àº™àº‚à»‰àº²àº‡àº„àº½àº‡àºˆàº²àºàºàº²àº™à»ƒàºŠà»‰àº¢àº² (Local AI)",
          role: "à»€àº„àº·à»ˆàº­àº‡àº¡àº·àºªàº³àº¥àº±àºšà»àºžàº”àºàº²àº™àº¢àº²",
          headerPatient: "1 àº‚à»à»‰àº¡àº¹àº™àºœàº¹à»‰àº›à»ˆàº§àº",
          labelName: "àºŠàº·à»ˆ-àº™àº²àº¡àºªàº°àºàº¸àº™",
          labelHN: "HN",
          labelUnit: "à»œà»ˆàº§àºàº‡àº²àº™àº›àº°à»€àº¡àºµàº™",
          labelDate: "àº§àº±àº™àº—àºµ",
          labelPharmacist: "à»àºžàº”àºàº²àº™àº¢àº²àºœàº¹à»‰àº›àº°à»€àº¡àºµàº™",
          labelLicense: "à»€àº¥àºà»ƒàºšàº›àº°àºàº­àºšàº§àº´àºŠàº²àºŠàºµàºš",
          headerHistory: "àº›àº°àº«àº§àº±àº”àºàº²àº™à»àºžà»‰àº¢àº² (History)",
          subHistory: "à»€àºžàºµà»ˆàº¡àº¥àº²àºàºàº²àº™àº¢àº²àº—àºµà»ˆàº®àº¹à»‰àº›àº°àº«àº§àº±àº”à»àºžà»‰à»àº¥à»‰àº§",
          labelHistoryDrug: "àºŠàº·à»ˆàº¢àº²",
          labelHistorySymptoms: "àº­àº²àºàº²àº™",
          labelHistoryDate: "àº§àº±àº™àº—àºµ (àº–à»‰àº²àº®àº¹à»‰)",
          btnAdd: "+ à»€àºžàºµà»ˆàº¡",
          noHistoryAdded: "àºàº±àº‡àºšà»à»ˆàº¡àºµàº›àº°àº«àº§àº±àº”",
          headerCurrentEvent: "2 àºàº²àº™àº›àº°à»€àº¡àºµàº™àº¢àº²àº—àºµà»ˆàºªàº»àº‡à»„àºª",
          drugLabel: "àºŠàº·à»ˆàº¢àº²àº—àºµà»ˆàºªàº»àº‡à»„àºª",
          drugPlaceholder: "à»€àºŠàº±à»ˆàº™: Amoxicillin",
          reactionLabel: "àº¥àº²àºàº¥àº°àº­àº½àº”àº­àº²àºàº²àº™à»àºžà»‰",
          reactionPlaceholder: "à»€àºŠàº±à»ˆàº™: àºœàº·à»ˆàº™à»àº”àº‡, àº„àº±àº™",
          questionsHeader: "àº„àº³àº–àº²àº¡àº›àº°à»€àº¡àºµàº™ Naranjo",
          answered: "àº•àº­àºšà»àº¥à»‰àº§",
          viewResults: "à»€àºšàº´à»ˆàº‡àºœàº»àº™àºàº²àº™àº§àº´à»€àº„àº²àº°",
          completeAll: "àºàº°àº¥àº¸àº™àº²àº•àº­àºšàº„àº³àº–àº²àº¡à»ƒàº«à»‰àº„àº»àºšàº–à»‰àº§àº™",
          scoreTitle: "àº„àº°à»àº™àº™àº„àº§àº²àº¡à»€àº›àº±àº™à»„àº›à»„àº”à»‰",
          classification: "àºàº²àº™à»àº›àºœàº»àº™",
          drug: "àº¢àº²",
          event: "àº­àº²àºàº²àº™",
          reset: "à»€àº¥àºµà»ˆàº¡àºàº²àº™àº›àº°à»€àº¡àºµàº™à»ƒà»à»ˆ",
          yes: "à»àº¡à»ˆàº™",
          no: "àºšà»à»ˆ",
          dontKnow: "àºšà»à»ˆàº®àº¹à»‰",
          interpretations: {
            definite: "à»àº¡à»ˆàº™à»àº™à»ˆàº™àº­àº™ (Definite)",
            probable: "à»œà»‰àº²àºˆàº°à»àº¡à»ˆàº™ (Probable)",
            possible: "àº­àº²àº”àºˆàº°à»àº¡à»ˆàº™ (Possible)",
            doubtful: "à»œà»‰àº²àºªàº»àº‡à»„àºª (Doubtful)"
          },
          cardTitle: "àºšàº±àº”à»àºžà»‰àº¢àº² (Drug Allergy Card)",
          cardTableDrug: "àºŠàº·à»ˆàº¢àº²",
          cardTableSymptom: "àº­àº²àºàº²àº™",
          cardTableDate: "àº§àº±àº™àº—àºµ",
          cardTableResult: "àºœàº»àº™àº›àº°à»€àº¡àºµàº™",
          cardHistoryLabel: "àº›àº°àº«àº§àº±àº”à»€àºàº»à»ˆàº² (H)",
          cardFooterWarning: "à»‚àº›àº”àºªàº°à»àº”àº‡àºšàº±àº”àº™àºµà»‰àº—àº¸àºàº„àº±à»‰àº‡àº—àºµà»ˆà»€àº‚àº»à»‰àº²àº®àº±àºšàºšà»àº¥àº´àºàº²àº™",
          cardFooterWarningEn: "Please show this card every visit.",
          printCardBtn: "àºžàº´àº¡àºšàº±àº”à»àºžà»‰àº¢àº²",
          printReportBtn: "àºžàº´àº¡àºšàº»àº”àº¥àº²àºàº‡àº²àº™ (A4)",
          assessor: "àºœàº¹à»‰àº›àº°à»€àº¡àºµàº™",
          guidelineBtn: "àº„àº¹à»ˆàº¡àº· ADR",
          // AI
          analyzeBtn: "àº§àº´à»€àº„àº²àº°àº”à»‰àº§àº AI (Local)",
          analyzing: "àºàº³àº¥àº±àº‡àº§àº´à»€àº„àº²àº°...",
          aiError: "àºšà»à»ˆàºªàº²àº¡àº²àº”à»€àºŠàº·à»ˆàº­àº¡àº•à»à»ˆ Ollama",
          riskLevel: "àº¥àº°àº”àº±àºšàº„àº§àº²àº¡àºªà»ˆàº½àº‡",
          recommendations: "àº„àº³à»àº™àº°àº™àº³àºˆàº²àº AI",
          aiDisclaimer: "àº„àº³à»€àº•àº·àº­àº™: àºœàº»àº™àºàº²àº™àº§àº´à»€àº„àº²àº°àºˆàº²àº AI à»ƒàºŠà»‰à»€àºžàº·à»ˆàº­àº›àº°àºàº­àºšàºàº²àº™àº•àº±àº”àºªàº´àº™à»ƒàºˆà»€àº—àº»à»ˆàº²àº™àº±à»‰àº™.",
          riskFactors: { Low: "àº•à»à»ˆàº²", Medium: "àº›àº²àº™àºàº²àº‡", High: "àºªàº¹àº‡", Unknown: "àºšà»à»ˆàº®àº¹à»‰" }
        },
        my: {
          title: "Naranjo AI Assessor - Warinchamrab Hospital",
          subtitle: "á€†á€±á€¸á€á€«á€¸á€†á€­á€¯á€¸á€€á€»á€­á€¯á€¸á€™á€»á€¬á€¸ á€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€»á€± á€á€­á€¯á€„á€ºá€¸á€á€¬á€á€¼á€„á€ºá€¸ (Local AI)",
          role: "á€†á€±á€¸á€á€«á€¸á€•á€Šá€¬á€›á€¾á€„á€ºá€™á€»á€¬á€¸á€¡á€á€½á€€á€º",
          headerPatient: "1 á€œá€°á€”á€¬á€¡á€á€»á€€á€ºá€¡á€œá€€á€º",
          labelName: "á€¡á€™á€Šá€º",
          labelHN: "HN",
          labelUnit: "á€Œá€¬á€”",
          labelDate: "á€”á€±á€·á€…á€½á€²",
          labelPharmacist: "á€†á€±á€¸á€á€«á€¸á€•á€Šá€¬á€›á€¾á€„á€º",
          labelLicense: "á€œá€­á€¯á€„á€ºá€…á€„á€ºá€”á€¶á€•á€«á€á€º",
          headerHistory: "á€šá€á€„á€ºá€†á€±á€¸á€™á€á€Šá€·á€ºá€žá€Šá€·á€º á€›á€¬á€‡á€á€„á€º",
          subHistory: "á€žá€­á€›á€¾á€­á€‘á€¬á€¸á€žá€±á€¬ á€†á€±á€¸á€™á€á€Šá€·á€ºá€™á€¾á€¯á€™á€»á€¬á€¸á€€á€­á€¯ á€‘á€Šá€·á€ºá€•á€«",
          labelHistoryDrug: "á€†á€±á€¸á€¡á€™á€Šá€º",
          labelHistorySymptoms: "á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸",
          labelHistoryDate: "á€”á€±á€·á€…á€½á€²",
          btnAdd: "+ á€‘á€Šá€·á€ºá€•á€«",
          noHistoryAdded: "á€›á€¬á€‡á€á€„á€º á€™á€›á€¾á€­á€žá€±á€¸á€•á€«",
          headerCurrentEvent: "2 á€žá€¶á€žá€šá€›á€¾á€­á€žá€±á€¬á€†á€±á€¸á€€á€­á€¯ á€†á€”á€ºá€¸á€…á€…á€ºá€á€¼á€„á€ºá€¸",
          drugLabel: "á€žá€¶á€žá€šá€›á€¾á€­á€žá€±á€¬á€†á€±á€¸",
          drugPlaceholder: "á€¥á€•á€™á€¬ - Amoxicillin",
          reactionLabel: "á€†á€­á€¯á€¸á€€á€»á€­á€¯á€¸á€œá€€á€¹á€á€á€¬",
          reactionPlaceholder: "á€¥á€•á€™á€¬ - á€¡á€”á€®á€€á€½á€€á€ºá€‘á€½á€€á€ºá€á€¼á€„á€ºá€¸",
          questionsHeader: "Naranjo á€™á€±á€¸á€á€½á€”á€ºá€¸á€™á€»á€¬á€¸",
          answered: "á€–á€¼á€±á€•á€¼á€®á€¸",
          viewResults: "á€›á€œá€’á€ºá€€á€¼á€Šá€·á€ºá€›á€”á€º",
          completeAll: "á€€á€»á€±á€¸á€‡á€°á€¸á€•á€¼á€¯á á€™á€±á€¸á€á€½á€”á€ºá€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸á€–á€¼á€±á€•á€«",
          scoreTitle: "á€›á€™á€¾á€á€º",
          classification: "á€¡á€“á€­á€•á€¹á€•á€«á€šá€ºá€–á€½á€„á€·á€ºá€†á€­á€¯á€á€»á€€á€º",
          drug: "á€†á€±á€¸",
          event: "á€–á€¼á€…á€ºá€›á€•á€º",
          reset: "á€¡á€…á€™á€¾á€•á€¼á€”á€ºá€…á€›á€”á€º",
          yes: "á€Ÿá€¯á€á€º",
          no: "á€™á€Ÿá€¯á€á€º",
          dontKnow: "á€™á€žá€­",
          interpretations: {
            definite: "á€žá€±á€á€»á€¬á€•á€«á€žá€Šá€º (Definite)",
            probable: "á€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€»á€±á€™á€»á€¬á€¸á€žá€Šá€º (Probable)",
            possible: "á€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€»á€±á€›á€¾á€­á€žá€Šá€º (Possible)",
            doubtful: "á€žá€¶á€žá€šá€–á€¼á€…á€ºá€–á€½á€šá€º (Doubtful)"
          },
          cardTitle: "á€†á€±á€¸á€™á€á€Šá€·á€ºá€žá€Šá€·á€ºá€€á€á€º (Drug Allergy Card)",
          cardTableDrug: "á€†á€±á€¸á€¡á€™á€Šá€º",
          cardTableSymptom: "á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸",
          cardTableDate: "á€”á€±á€·á€…á€½á€²",
          cardTableResult: "á€›á€œá€’á€º",
          cardHistoryLabel: "History (H)",
          cardFooterWarning: "á€†á€±á€¸á€á€”á€ºá€¸á€•á€¼á€á€­á€¯á€„á€ºá€¸ á€¤á€€á€á€ºá€€á€­á€¯á€•á€¼á€•á€«",
          cardFooterWarningEn: "Please show this card every visit.",
          printCardBtn: "á€€á€á€ºá€‘á€¯á€á€ºá€›á€”á€º",
          printReportBtn: "á€¡á€…á€®á€›á€„á€ºá€á€¶á€…á€¬ á€‘á€¯á€á€ºá€šá€°á€™á€Šá€º (A4)",
          assessor: "á€…á€…á€ºá€†á€±á€¸á€žá€°",
          guidelineBtn: "ADR á€œá€™á€ºá€¸á€Šá€½á€¾á€”á€º",
          // AI
          analyzeBtn: "AI á€†á€”á€ºá€¸á€…á€…á€ºá€á€»á€€á€º (Local)",
          analyzing: "á€†á€”á€ºá€¸á€…á€…á€ºá€”á€±á€žá€Šá€º...",
          aiError: "Ollama á€á€»á€­á€á€ºá€†á€€á€ºá€™á€›á€•á€«",
          riskLevel: "á€¡á€”á€¹á€á€›á€¬á€šá€ºá€¡á€†á€„á€·á€º",
          recommendations: "AI á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€º",
          aiDisclaimer: "á€žá€á€­á€•á€±á€¸á€á€»á€€á€º - AI á€›á€œá€’á€ºá€žá€Šá€º á€¡á€‘á€±á€¬á€€á€ºá€¡á€€á€°á€•á€¼á€¯á€›á€¯á€¶á€žá€¬á€–á€¼á€…á€ºá€žá€Šá€ºá‹",
          riskFactors: { Low: "á€¡á€”á€­á€™á€·á€º", Medium: "á€¡á€œá€šá€ºá€¡á€œá€á€º", High: "á€¡á€™á€¼á€„á€·á€º", Unknown: "á€™á€žá€­" }
        }
      };

      const interpretScore = (score) => {
        if (score >= 9) return "Definite";
        if (score >= 5) return "Probable";
        if (score >= 1) return "Possible";
        return "Doubtful";
      };

      const getColorForScore = (score) => {
        if (score >= 9) return "text-red-600 bg-red-50 border-red-200"; 
        if (score >= 5) return "text-orange-600 bg-orange-50 border-orange-200"; 
        if (score >= 1) return "text-yellow-600 bg-yellow-50 border-yellow-200"; 
        return "text-slate-600 bg-slate-50 border-slate-200"; 
      };

      // --- COMPONENTS ---

      // Header Component
      const Header = ({ lang, setLang, t }) => {
        const languages = [
          { code: 'th', label: 'à¹„à¸—à¸¢', flag: 'ðŸ‡¹ðŸ‡­' },
          { code: 'en', label: 'ENG', flag: 'ðŸ‡¬ðŸ‡§' },
          { code: 'lo', label: 'àº¥àº²àº§', flag: 'ðŸ‡±ðŸ‡¦' },
          { code: 'my', label: 'á€—á€™á€¬', flag: 'ðŸ‡²ðŸ‡²' },
        ];

        return (
          <header className="bg-white border-b border-slate-200 sticky top-0 z-50">
            <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
              <div className="flex items-center space-x-3">
                <img
                  src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYvahIeXlj40inpCDGCZxz6ytgMnT7fcHWOYlB3Y0EFDX3EBRI8s5EAXrhpD7CFajRPbU&usqp=CAU"
                  alt="Warinchamrab Hospital Logo"
                  className="h-12 w-12 rounded-full shadow-md object-cover border border-slate-100"
                />
                <div className="overflow-hidden">
                  <h1 className="text-lg sm:text-xl font-bold text-slate-800 tracking-tight truncate">{t.title}</h1>
                  <p className="text-[10px] sm:text-xs text-slate-500 font-medium truncate">{t.subtitle}</p>
                </div>
              </div>
              
              <div className="flex items-center gap-2 sm:gap-4">
                <div className="hidden sm:flex items-center space-x-2 text-sm font-medium text-teal-700 bg-teal-50 px-3 py-1 rounded-full">
                  <Pill className="h-4 w-4" />
                  <span>{t.role}</span>
                </div>

                <a
                  href="https://heyzine.com/flip-book/3b0913bf57.html#page/82"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2 bg-[#556b2f] text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-[#3e4e22] transition-colors shadow-sm"
                  title="à¸„à¸¹à¹ˆà¸¡à¸·à¸­/à¹à¸™à¸§à¸—à¸²à¸‡à¸›à¸à¸´à¸šà¸±à¸•à¸´"
                >
                  <BookOpen className="h-4 w-4" />
                  <span className="hidden sm:inline">{t.guidelineBtn}</span>
                  <span className="sm:hidden">ADR</span>
                </a>

                <div className="flex bg-slate-100 p-1 rounded-lg">
                  {languages.map((l) => (
                    <button
                      key={l.code}
                      onClick={() => setLang(l.code)}
                      className={`px-2 sm:px-3 py-1 rounded-md text-xs font-bold transition-all ${
                        lang === l.code
                          ? 'bg-white text-teal-700 shadow-sm'
                          : 'text-slate-400 hover:text-slate-600'
                      }`}
                      title={l.label}
                    >
                      <span className="sm:hidden">{l.flag}</span>
                      <span className="hidden sm:inline">{l.label}</span>
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </header>
        );
      };

      // QuestionItem Component
      const QuestionItem = ({ question, currentAnswer, onAnswer, t }) => {
        const baseButtonClass = "flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all duration-200 w-full sm:w-24 space-y-1";
        
        return (
          <div className="bg-white rounded-xl p-5 shadow-sm border border-slate-100 hover:shadow-md transition-shadow">
            <div className="flex flex-col sm:flex-row sm:items-start gap-4 justify-between">
              <div className="flex-1">
                  <span className="inline-block px-2 py-1 bg-slate-100 text-slate-500 text-xs font-bold rounded mb-2">
                      Question {question.id}
                  </span>
                <h3 className="text-md font-medium text-slate-800 leading-relaxed">{question.text}</h3>
              </div>
              
              <div className="flex gap-2 sm:gap-3 shrink-0 mt-2 sm:mt-0">
                <button
                  onClick={() => onAnswer(question.id, 'Yes', question.yesScore)}
                  className={`${baseButtonClass} ${
                    currentAnswer === 'Yes'
                      ? 'border-teal-500 bg-teal-50 text-teal-700'
                      : 'border-slate-100 text-slate-400 hover:border-teal-200 hover:bg-slate-50'
                  }`}
                >
                  <Check className="h-5 w-5" />
                  <span className="text-xs font-semibold">{t.yes} ({question.yesScore > 0 ? `+${question.yesScore}` : question.yesScore})</span>
                </button>

                <button
                  onClick={() => onAnswer(question.id, 'No', question.noScore)}
                  className={`${baseButtonClass} ${
                    currentAnswer === 'No'
                      ? 'border-red-500 bg-red-50 text-red-700'
                      : 'border-slate-100 text-slate-400 hover:border-red-200 hover:bg-slate-50'
                  }`}
                >
                  <X className="h-5 w-5" />
                  <span className="text-xs font-semibold">{t.no} ({question.noScore > 0 ? `+${question.noScore}` : question.noScore})</span>
                </button>

                <button
                  onClick={() => onAnswer(question.id, 'DontKnow', question.dontKnowScore)}
                  className={`${baseButtonClass} ${
                    currentAnswer === 'DontKnow'
                      ? 'border-blue-400 bg-blue-50 text-blue-700'
                      : 'border-slate-100 text-slate-400 hover:border-blue-200 hover:bg-slate-50'
                  }`}
                >
                  <HelpCircle className="h-5 w-5" />
                  <span className="text-xs font-semibold">{t.dontKnow} ({question.dontKnowScore})</span>
                </button>
              </div>
            </div>
          </div>
        );
      };

      // DrugAllergyCard Component
      const DrugAllergyCard = ({ patientDetails, reportData, t }) => {
        const cardItems = [
          ...patientDetails.history.map(h => ({
            drug: h.drugName,
            symptoms: h.symptoms,
            date: h.reactionDate || '-',
            result: t.cardHistoryLabel
          })),
          ...(reportData.drugName ? [{
            drug: reportData.drugName,
            symptoms: reportData.reactionDescription,
            date: patientDetails.date || '-',
            result: `${reportData.interpretation.split(' ')[0]}`
          }] : [])
        ];

        return (
          <div className="printable-card-container font-sans hidden print:flex items-center justify-center w-full h-full">
            <div 
              className="bg-white border-2 border-blue-700 rounded-xl p-2 flex flex-col justify-between overflow-hidden relative"
              style={{ width: '8.5cm', height: '5.5cm' }}
            >
              <div className="flex items-center justify-center border-b-2 border-blue-700 pb-1 mb-1 relative">
                  <img
                      src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYvahIeXlj40inpCDGCZxz6ytgMnT7fcHWOYlB3Y0EFDX3EBRI8s5EAXrhpD7CFajRPbU&usqp=CAU"
                      alt="Logo"
                      className="h-6 w-6 rounded-full object-cover absolute left-1"
                  />
                  <h1 className="text-blue-800 font-bold text-sm leading-tight pl-4">{t.cardTitle}</h1>
              </div>

              <div className="flex flex-col text-[10px] text-slate-800 mb-1 font-semibold space-y-0.5 px-1">
                <div className="flex items-baseline">
                   <span className="w-12 text-slate-600">{t.labelName}:</span>
                   <span className="truncate flex-1">{patientDetails.fullName || '...................................'}</span>
                </div>
                <div className="flex items-baseline">
                   <span className="w-12 text-slate-600">{t.labelHN}:</span>
                   <span className="truncate flex-1">{patientDetails.hn || '...................................'}</span>
                </div>
              </div>

              <div className="flex-grow border border-blue-300 rounded overflow-hidden mb-1 relative">
                <table className="w-full text-[8px] table-fixed">
                  <thead className="bg-blue-100 text-blue-900">
                    <tr>
                      <th className="w-[28%] p-0.5 text-left pl-1 font-bold border-r border-blue-200">{t.cardTableDrug}</th>
                      <th className="w-[28%] p-0.5 text-left pl-1 font-bold border-r border-blue-200">{t.cardTableSymptom}</th>
                      <th className="w-[22%] p-0.5 text-left pl-1 font-bold border-r border-blue-200">{t.cardTableDate}</th>
                      <th className="w-[22%] p-0.5 text-left pl-1 font-bold">{t.cardTableResult}</th>
                    </tr>
                  </thead>
                  <tbody className="text-slate-700">
                    {cardItems.slice(0, 5).map((item, idx) => (
                      <tr key={idx} className="border-b border-slate-100 last:border-0">
                        <td className="p-0.5 pl-1 truncate border-r border-slate-100 font-semibold text-blue-900">{item.drug}</td>
                        <td className="p-0.5 pl-1 truncate border-r border-slate-100">{item.symptoms}</td>
                        <td className="p-0.5 pl-1 truncate border-r border-slate-100 text-slate-600">{item.date}</td>
                        <td className="p-0.5 pl-1 truncate text-teal-700 font-medium">{item.result}</td>
                      </tr>
                    ))}
                    {[...Array(Math.max(0, 3 - cardItems.length))].map((_, i) => (
                       <tr key={`empty-${i}`} className="border-b border-slate-100 last:border-0 h-3">
                          <td className="border-r border-slate-100"></td>
                          <td className="border-r border-slate-100"></td>
                          <td className="border-r border-slate-100"></td>
                          <td></td>
                       </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              <div className="text-[7px] text-slate-600 px-1 mt-auto">
                <div className="flex justify-between items-end">
                  <div className="space-y-0.5">
                     <p><span className="font-bold text-blue-800">{t.labelUnit}:</span> {patientDetails.unit || '-'}</p>
                     <p>
                       <span className="font-bold text-blue-800">{t.assessor}:</span> {patientDetails.pharmacistName} {patientDetails.licenseNo ? `(${patientDetails.licenseNo})` : ''}
                     </p>
                     <p><span className="font-bold text-blue-800">{t.labelDate}:</span> {patientDetails.date}</p>
                  </div>
                  <div className="text-right">
                     <p className="text-red-600 font-bold">{t.cardFooterWarning}</p>
                     <p className="text-red-500 italic font-medium">{t.cardFooterWarningEn}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // ResultsSection Component
      const ResultsSection = ({ totalScore, drugName, reaction, reportData, t }) => {
        const cardRef = useRef(null);
        const [aiResult, setAiResult] = useState(null);
        const [isLoadingAI, setIsLoadingAI] = useState(false);
        const [aiError, setAiError] = useState(null);

        const interpretationKey = interpretScore(totalScore).toLowerCase();
        const interpretationLabel = t.interpretations[interpretationKey] || interpretScore(totalScore);
        const colorClass = getColorForScore(totalScore);

        const handleAnalyzeAI = async () => {
          setIsLoadingAI(true);
          setAiError(null);
          setAiResult(null);
          
          try {
            const response = await fetch('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(reportData)
            });
            
            if (!response.ok) throw new Error("Backend Error");
            
            const data = await response.json();
            if(data.error) throw new Error(data.error);
            setAiResult(data);
          } catch (err) {
            setAiError(t.aiError + ": " + err.message);
          } finally {
            setIsLoadingAI(false);
          }
        };

        const handlePrintCard = () => {
          if (!cardRef.current) return;
          const cardContent = cardRef.current.innerHTML;
          const printWindow = window.open('', '_blank');
          if (printWindow) {
            printWindow.document.write(`
              <!DOCTYPE html>
              <html>
                <head>
                  <title>${t.cardTitle}</title>
                  <script src="https://cdn.tailwindcss.com"></script>
                  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                  <style>
                    body {
                      font-family: 'Inter', sans-serif;
                      background-color: #f8fafc;
                      display: flex; justify-content: center; align-items: center;
                      min-height: 100vh; margin: 0;
                    }
                    .printable-card-container {
                      display: flex !important; visibility: visible !important;
                      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); margin: auto;
                    }
                    @media print {
                      body { background-color: white; display: block; }
                      .printable-card-container {
                        box-shadow: none; position: absolute;
                        top: 50%; left: 50%; transform: translate(-50%, -50%); margin: 0;
                      }
                      @page { size: auto; margin: 0mm; }
                    }
                  </style>
                </head>
                <body>${cardContent}<script>setTimeout(() => { window.print(); }, 1000);</script></body>
              </html>
            `);
            printWindow.document.close();
          }
        };

        const handlePrintReport = () => {
          const printWindow = window.open('', '_blank');
          if (!printWindow) return;

          const questions = QUESTIONS_BY_LANG[reportData.language];
          const questionsHtml = reportData.answers.map((ans, idx) => {
              const qText = questions[idx].text;
              return `<tr class="border-b border-slate-200 text-xs"><td class="py-2 pr-2 text-slate-600">${idx + 1}. ${qText}</td><td class="py-2 px-2 text-center font-medium">${ans.answer || '-'}</td><td class="py-2 pl-2 text-center font-bold text-slate-800">${ans.score}</td></tr>`;
          }).join('');

          const historyHtml = reportData.patientDetails?.history && reportData.patientDetails.history.length > 0 
              ? reportData.patientDetails.history.map(h => `<tr class="border-b border-slate-100 text-xs"><td class="py-2 text-slate-800 font-semibold">${h.drugName}</td><td class="py-2 text-slate-600">${h.symptoms}</td><td class="py-2 text-slate-500">${h.reactionDate || '-'}</td></tr>`).join('')
              : `<tr><td colspan="3" class="py-3 text-center text-xs text-slate-400 italic">${t.noHistoryAdded}</td></tr>`;

          const aiSectionHtml = aiResult ? `
            <div class="mb-6 bg-teal-50 border border-teal-100 rounded-lg p-4 break-inside-avoid">
                <h3 class="font-bold text-teal-800 border-b border-teal-200 pb-1 mb-2">AI Clinical Analysis</h3>
                <p class="text-sm text-slate-700 mb-3">${aiResult.analysis}</p>
                <div class="mb-2"><span class="font-bold text-xs uppercase text-teal-700">Risk Level:</span> <span class="text-sm font-bold text-slate-900">${aiResult.riskFactor}</span></div>
                <div class="text-sm text-slate-700 font-bold mb-1">Recommendations:</div>
                <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                   ${aiResult.recommendations.map(r => `<li>${r}</li>`).join('')}
                </ul>
                <p class="text-[10px] text-slate-400 mt-3 italic">Generated by MedGemma 4B (Local AI)</p>
            </div>
          ` : '';

          printWindow.document.write(`
              <!DOCTYPE html>
              <html>
              <head>
                  <title>Naranjo Assessment Report</title>
                  <script src="https://cdn.tailwindcss.com"></script>
                  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                  <style>body { font-family: 'Inter', sans-serif; background: white; } @page { size: A4; margin: 20mm; } @media print { body { -webkit-print-color-adjust: exact; } }</style>
              </head>
              <body class="p-8 max-w-[210mm] mx-auto">
                  <div class="flex items-center justify-between border-b-2 border-slate-800 pb-4 mb-6">
                      <div class="flex items-center gap-4">
                          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYvahIeXlj40inpCDGCZxz6ytgMnT7fcHWOYlB3Y0EFDX3EBRI8s5EAXrhpD7CFajRPbU&usqp=CAU" class="h-16 w-16 rounded-full object-cover" />
                          <div><h1 class="text-xl font-bold text-slate-900">Naranjo Assessor</h1><p class="text-sm text-slate-600">Warinchamrab Hospital</p></div>
                      </div>
                      <div class="text-right"><p class="text-xs text-slate-500">Report Date</p><p class="font-bold text-slate-800">${new Date().toLocaleDateString('th-TH')}</p></div>
                  </div>
                  <div class="grid grid-cols-2 gap-6 mb-6 text-sm">
                      <div><h3 class="font-bold text-slate-700 border-b border-slate-200 pb-1 mb-2">Patient Information</h3><table class="w-full"><tr><td class="py-1 text-slate-500 w-24">Name:</td><td class="font-medium">${reportData.patientDetails?.fullName || '-'}</td></tr><tr><td class="py-1 text-slate-500">HN:</td><td class="font-medium">${reportData.patientDetails?.hn || '-'}</td></tr><tr><td class="py-1 text-slate-500">Unit:</td><td class="font-medium">${reportData.patientDetails?.unit || '-'}</td></tr></table></div>
                      <div><h3 class="font-bold text-slate-700 border-b border-slate-200 pb-1 mb-2">Assessor Information</h3><table class="w-full"><tr><td class="py-1 text-slate-500 w-24">Pharmacist:</td><td class="font-medium">${reportData.patientDetails?.pharmacistName || '-'}</td></tr><tr><td class="py-1 text-slate-500">License No:</td><td class="font-medium">${reportData.patientDetails?.licenseNo || '-'}</td></tr><tr><td class="py-1 text-slate-500">Date:</td><td class="font-medium">${reportData.patientDetails?.date || '-'}</td></tr></table></div>
                  </div>
                  <div class="mb-6"><h3 class="font-bold text-slate-700 border-b border-slate-200 pb-1 mb-2">History of Drug Allergy</h3><table class="w-full text-left"><thead><tr class="text-xs text-slate-500 border-b border-slate-200"><th class="py-1 font-normal w-1/3">Drug Name</th><th class="py-1 font-normal w-1/3">Symptoms</th><th class="py-1 font-normal w-1/3">Date</th></tr></thead><tbody>${historyHtml}</tbody></table></div>
                  <div class="bg-slate-50 border border-slate-200 rounded-lg p-4 mb-6 flex items-center justify-between">
                      <div><p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Suspected Drug</p><p class="text-lg font-bold text-slate-900">${drugName || '-'}</p><p class="text-sm text-slate-600 mt-1">Event: ${reaction || '-'}</p></div>
                      <div class="text-right"><p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Naranjo Score</p><div class="flex items-baseline justify-end gap-2"><span class="text-3xl font-bold text-slate-900">${totalScore}</span><span class="text-sm font-bold px-2 py-1 rounded bg-white border border-slate-200 shadow-sm">${interpretationLabel}</span></div></div>
                  </div>
                  ${aiSectionHtml}
                  <div class="mb-8"><h3 class="font-bold text-slate-700 border-b border-slate-200 pb-1 mb-3">Assessment Details</h3><table class="w-full"><thead><tr class="text-xs text-slate-500 border-b border-slate-300"><th class="py-2 text-left w-3/4">Question</th><th class="py-2 text-center w-24">Answer</th><th class="py-2 text-center w-16">Score</th></tr></thead><tbody>${questionsHtml}</tbody></table></div>
                  <div class="mt-12 grid grid-cols-2 gap-12 break-inside-avoid"><div class="text-center"><div class="border-b border-slate-300 h-12 mb-2"></div><p class="text-sm font-medium text-slate-800">(${reportData.patientDetails?.pharmacistName || '................................................'})</p><p class="text-xs text-slate-500">Pharmacist</p></div><div class="text-center"><div class="border-b border-slate-300 h-12 mb-2"></div><p class="text-sm font-medium text-slate-800">................................................</p><p class="text-xs text-slate-500">Physician / Reviewer</p></div></div>
                  <script>setTimeout(() => { window.print(); }, 1000);</script>
              </body></html>
          `);
          printWindow.document.close();
        };

        return (
          <div className="space-y-6">
            <div className="hidden" ref={cardRef}>
              <DrugAllergyCard patientDetails={reportData.patientDetails} reportData={reportData} t={t} />
            </div>
            <div className="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
              <div className="p-6 sm:p-8 border-b border-slate-100">
                <div className="flex flex-col sm:flex-row justify-between items-center gap-6">
                  <div className="text-center sm:text-left">
                    <h2 className="text-slate-500 text-sm font-semibold uppercase tracking-wider mb-1">{t.scoreTitle}</h2>
                    <div className="flex items-baseline justify-center sm:justify-start gap-2">
                      <span className="text-5xl font-bold text-slate-900">{totalScore}</span>
                      <span className="text-slate-400 text-sm font-medium">/ 13 max</span>
                    </div>
                  </div>
                  <div className={`px-6 py-3 rounded-xl border-2 flex flex-col items-center justify-center ${colorClass} min-w-[200px]`}>
                    <span className="text-xs font-bold uppercase tracking-widest opacity-80">{t.classification}</span>
                    <span className="text-lg sm:text-xl font-bold text-center">{interpretationLabel}</span>
                  </div>
                </div>
              </div>
              
              {/* AI Section */}
              <div className="bg-indigo-50 px-6 py-5 border-b border-indigo-100">
                {!aiResult ? (
                    <div className="flex justify-center">
                       <button 
                          onClick={handleAnalyzeAI} 
                          disabled={isLoadingAI}
                          className="flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm hover:bg-indigo-700 transition-all shadow-md hover:shadow-indigo-200 disabled:opacity-70"
                        >
                            {isLoadingAI ? (
                                <><div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> {t.analyzing}</>
                            ) : (
                                <><BrainCircuit className="h-4 w-4" /> {t.analyzeBtn}</>
                            )}
                        </button>
                    </div>
                ) : (
                    <div className="space-y-4 animate-in fade-in slide-in-from-top-2 duration-500">
                        <div className="flex items-start gap-3">
                            <div className="bg-indigo-100 p-2 rounded-lg"><Stethoscope className="h-5 w-5 text-indigo-600" /></div>
                            <div className="flex-1">
                                <h4 className="font-bold text-indigo-900 text-sm uppercase tracking-wide mb-1">AI Clinical Analysis</h4>
                                <p className="text-slate-700 text-sm leading-relaxed">{aiResult.analysis}</p>
                            </div>
                        </div>
                        <div className="flex flex-col sm:flex-row gap-4">
                             <div className={`flex-1 p-3 rounded-lg border ${
                                 aiResult.riskFactor === 'High' ? 'bg-red-50 border-red-200' : 
                                 aiResult.riskFactor === 'Medium' ? 'bg-orange-50 border-orange-200' : 
                                 'bg-green-50 border-green-200'
                             }`}>
                                 <div className="flex items-center gap-2 mb-1">
                                     <AlertTriangle className={`h-4 w-4 ${
                                         aiResult.riskFactor === 'High' ? 'text-red-600' : 
                                         aiResult.riskFactor === 'Medium' ? 'text-orange-600' : 
                                         'text-green-600'
                                     }`} />
                                     <span className="text-xs font-bold uppercase text-slate-500">{t.riskLevel}</span>
                                 </div>
                                 <p className="font-bold text-slate-800 pl-6">{t.riskFactors[aiResult.riskFactor] || aiResult.riskFactor}</p>
                             </div>
                             <div className="flex-[2] bg-white p-3 rounded-lg border border-indigo-100">
                                 <div className="flex items-center gap-2 mb-2">
                                     <Sparkles className="h-4 w-4 text-indigo-500" />
                                     <span className="text-xs font-bold uppercase text-slate-500">{t.recommendations}</span>
                                 </div>
                                 <ul className="list-disc list-inside text-sm text-slate-600 space-y-1 pl-1">
                                     {aiResult.recommendations.map((rec, i) => <li key={i}>{rec}</li>)}
                                 </ul>
                             </div>
                        </div>
                        <p className="text-[10px] text-slate-400 text-center italic">{t.aiDisclaimer}</p>
                    </div>
                )}
                {aiError && (
                    <div className="mt-4 bg-red-50 text-red-600 p-3 rounded-lg text-sm flex items-center justify-center gap-2">
                        <AlertCircle className="h-4 w-4" /> {aiError}
                    </div>
                )}
              </div>

              <div className="bg-slate-50 px-6 py-4 border-b border-slate-100 flex flex-col sm:flex-row gap-4 text-sm text-slate-600 justify-between items-center">
                <div className="flex flex-col sm:flex-row gap-4">
                  <div className="flex items-center gap-2"><span className="font-semibold text-slate-800">{t.drug}:</span> {drugName || "-"}</div>
                  <div className="hidden sm:block text-slate-300">|</div>
                  <div className="flex items-center gap-2"><span className="font-semibold text-slate-800">{t.event}:</span> {reaction || "-"}</div>
                </div>
                <div className="flex gap-2">
                  <button onClick={handlePrintCard} className="flex items-center gap-2 px-3 py-2 bg-white text-slate-700 border border-slate-200 text-xs font-bold rounded-lg hover:bg-slate-50 hover:text-blue-600 transition-colors shadow-sm">
                      <Printer className="h-4 w-4" />{t.printCardBtn}
                  </button>
                  <button onClick={handlePrintReport} className="flex items-center gap-2 px-3 py-2 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition-colors shadow-sm">
                      <FileCheck className="h-4 w-4" />{t.printReportBtn}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // PatientForm Component
      const PatientForm = ({ t, data, onChange }) => {
        const [newDrug, setNewDrug] = useState('');
        const [newSymptom, setNewSymptom] = useState('');
        const [newDate, setNewDate] = useState('');

        const handleInputChange = (field, value) => {
          onChange({ ...data, [field]: value });
        };

        const addHistoryItem = () => {
          if (newDrug.trim() && newSymptom.trim()) {
            const newItem = {
              id: Date.now().toString(),
              drugName: newDrug.trim(),
              symptoms: newSymptom.trim(),
              reactionDate: newDate || undefined
            };
            onChange({ ...data, history: [...data.history, newItem] });
            setNewDrug(''); setNewSymptom(''); setNewDate('');
          }
        };

        const removeHistoryItem = (id) => {
          onChange({ ...data, history: data.history.filter(item => item.id !== id) });
        };

        const ModernInput = ({ label, value, field, icon: Icon, type = "text", placeholder, colorClass = "blue" }) => {
          const focusRing = colorClass === "amber" ? "focus:ring-amber-500/10" : "focus:ring-blue-500/10";
          const focusBorder = colorClass === "amber" ? "focus:border-amber-500" : "focus:border-blue-500";
          const focusText = colorClass === "amber" ? "group-focus-within:text-amber-600" : "group-focus-within:text-blue-600";
          const iconColor = colorClass === "amber" ? "group-focus-within:text-amber-500" : "group-focus-within:text-blue-500";

          return (
            <div className="space-y-1.5 group">
              <label className={`block text-xs font-bold uppercase tracking-wide text-slate-500 ml-1 transition-colors ${focusText}`}>{label}</label>
              <div className="relative transition-all duration-200 transform group-focus-within:-translate-y-0.5">
                <div className={`absolute left-3 top-3.5 text-slate-400 transition-colors ${iconColor}`}><Icon className="h-5 w-5" /></div>
                <input type={type} value={value} onChange={(e) => field ? handleInputChange(field, e.target.value) : undefined}
                  className={`w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:bg-white ${focusBorder} focus:ring-4 ${focusRing} outline-none transition-all duration-200 font-medium text-slate-700 placeholder:text-slate-300 shadow-sm`}
                  placeholder={placeholder}
                />
              </div>
            </div>
          );
        };

        return (
          <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
              <div className="px-6 py-4 border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white flex items-center gap-3">
                <div className="bg-blue-600 text-white w-8 h-8 rounded-lg flex items-center justify-center shadow-blue-200 shadow-lg"><span className="font-bold text-sm">1</span></div>
                <h3 className="font-bold text-slate-800 text-lg tracking-tight">{t.headerPatient}</h3>
              </div>
              <div className="p-6 sm:p-8 space-y-8">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                   <ModernInput label={t.labelName} value={data.fullName} field="fullName" icon={User} placeholder="..." />
                   <ModernInput label={t.labelHN} value={data.hn} field="hn" icon={FileDigit} placeholder="..." />
                   <ModernInput label={t.labelUnit} value={data.unit} field="unit" icon={Building2} placeholder="..." />
                   <ModernInput label={t.labelDate} value={data.date} field="date" icon={CalendarDays} type="date" />
                </div>
                <div className="relative"><div className="absolute inset-0 flex items-center"><div className="w-full border-t border-slate-100"></div></div><div className="relative flex justify-center"><span className="bg-white px-4 text-xs font-bold text-slate-400 uppercase tracking-wider">{t.role}</span></div></div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                   <ModernInput label={t.labelPharmacist} value={data.pharmacistName} field="pharmacistName" icon={UserCog} placeholder="..." />
                   {/* REPLACED IdCard with CreditCard to fix import error */}
                   <ModernInput label={t.labelLicense} value={data.licenseNo} field="licenseNo" icon={CreditCard} placeholder="à¸ .xxxxx" />
                </div>
              </div>
            </div>
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden relative group">
              <div className="absolute top-0 left-0 w-1.5 h-full bg-amber-400"></div>
              <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-gradient-to-r from-amber-50/30 to-transparent">
                  <div className="flex items-center gap-3">
                      <div className="bg-amber-100 p-2 rounded-lg"><History className="h-5 w-5 text-amber-600" /></div>
                      <div><h3 className="font-bold text-slate-800 text-lg">{t.headerHistory}</h3><p className="text-xs text-slate-500 font-medium">{t.subHistory}</p></div>
                  </div>
              </div>
              <div className="p-6 sm:p-8 space-y-6">
                   <div className="bg-slate-50 rounded-xl p-4 border border-slate-100 space-y-4">
                      <div className="grid grid-cols-1 md:grid-cols-12 gap-3">
                          <div className="md:col-span-5">
                              <div className="relative group">
                                  <Pill className="absolute left-3 top-3 h-4 w-4 text-slate-400 group-focus-within:text-amber-500 transition-colors" />
                                  <input type="text" value={newDrug} onChange={(e) => setNewDrug(e.target.value)} placeholder={t.labelHistoryDrug} className="w-full pl-9 pr-3 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 outline-none transition-all placeholder:text-slate-400" />
                              </div>
                          </div>
                          <div className="md:col-span-5">
                               <div className="relative group">
                                  <AlertCircle className="absolute left-3 top-3 h-4 w-4 text-slate-400 group-focus-within:text-amber-500 transition-colors" />
                                  <input type="text" value={newSymptom} onChange={(e) => setNewSymptom(e.target.value)} placeholder={t.labelHistorySymptoms} className="w-full pl-9 pr-3 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 outline-none transition-all placeholder:text-slate-400" />
                              </div>
                          </div>
                          <div className="md:col-span-2">
                              <input type="date" value={newDate} onChange={(e) => setNewDate(e.target.value)} className="w-full px-2 py-2.5 bg-white border border-slate-200 rounded-lg text-sm focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 outline-none transition-all text-center text-slate-600" />
                          </div>
                      </div>
                      <button onClick={addHistoryItem} disabled={!newDrug.trim() || !newSymptom.trim()} className="w-full bg-amber-500 hover:bg-amber-600 disabled:bg-amber-200 disabled:cursor-not-allowed text-white py-2.5 rounded-lg font-bold text-sm shadow-sm hover:shadow-amber-200 transition-all flex items-center justify-center gap-2"><Plus className="h-4 w-4" />{t.btnAdd}</button>
                   </div>
                   <div className="space-y-2">
                      {data.history.length > 0 ? (
                          data.history.map((item) => (
                              <div key={item.id} className="group/item flex items-center justify-between p-3 rounded-lg border border-slate-100 hover:border-amber-200 hover:bg-amber-50/30 transition-all duration-200">
                                  <div className="flex items-center gap-4">
                                      <div className="h-8 w-8 rounded-full bg-slate-100 text-slate-500 font-bold flex items-center justify-center text-xs group-hover/item:bg-amber-100 group-hover/item:text-amber-700 transition-colors">H</div>
                                      <div>
                                          <div className="flex items-center gap-2"><span className="font-bold text-slate-700">{item.drugName}</span>{item.reactionDate && (<span className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded-full">{item.reactionDate}</span>)}</div>
                                          <p className="text-xs text-slate-500">{item.symptoms}</p>
                                      </div>
                                  </div>
                                  <button onClick={() => removeHistoryItem(item.id)} className="text-slate-300 hover:text-red-500 hover:bg-red-50 p-2 rounded-lg transition-colors opacity-0 group-hover/item:opacity-100" title="Remove"><Trash2 className="h-4 w-4" /></button>
                              </div>
                          ))
                      ) : (
                          <div className="py-8 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-100 rounded-xl"><History className="h-8 w-8 mb-2 opacity-20" /><p className="text-sm font-medium opacity-60">{t.noHistoryAdded}</p></div>
                      )}
                   </div>
              </div>
            </div>
          </div>
        );
      };

      // --- MAIN APP COMPONENT ---
      const App = () => {
        const [language, setLanguage] = useState('th');
        const [answers, setAnswers] = useState({});
        const [drugName, setDrugName] = useState("");
        const [reaction, setReaction] = useState("");
        
        const [patientDetails, setPatientDetails] = useState({
          fullName: '', hn: '', unit: '',
          date: new Date().toISOString().split('T')[0],
          pharmacistName: '', licenseNo: '', history: []
        });

        const resultsRef = useRef(null);
        const t = TRANSLATIONS[language];
        const questions = QUESTIONS_BY_LANG[language];

        const handleAnswer = (id, value) => {
          setAnswers(prev => ({ ...prev, [id]: value }));
        };

        const calculateScore = useMemo(() => {
          let score = 0;
          questions.forEach(q => {
            const ans = answers[q.id];
            if (ans === 'Yes') score += q.yesScore;
            else if (ans === 'No') score += q.noScore;
            else if (ans === 'DontKnow') score += q.dontKnowScore;
          });
          return score;
        }, [answers, questions]);

        const isComplete = Object.keys(answers).length === questions.length;

        const reportData = {
          drugName, reactionDescription: reaction, totalScore: calculateScore,
          interpretation: interpretScore(calculateScore),
          answers: questions.map(q => {
            const ans = answers[q.id];
            let s = 0;
            if (ans === 'Yes') s = q.yesScore;
            else if (ans === 'No') s = q.noScore;
            else if (ans === 'DontKnow') s = q.dontKnowScore;
            return { questionId: q.id, answer: ans || null, score: s };
          }),
          language, patientDetails
        };

        const handleReset = () => {
          setAnswers({}); setDrugName(""); setReaction("");
          setPatientDetails({
              fullName: '', hn: '', unit: '',
              date: new Date().toISOString().split('T')[0],
              pharmacistName: '', licenseNo: '', history: []
          });
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const scrollToResults = () => {
          resultsRef.current?.scrollIntoView({ behavior: 'smooth' });
        };

        return (
          <div className="min-h-screen bg-slate-50 pb-20 font-sans">
            <Header lang={language} setLang={setLanguage} t={t} />

            <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
              <PatientForm t={t} data={patientDetails} onChange={setPatientDetails} />

              <section className="bg-white rounded-2xl p-6 sm:p-8 shadow-sm border border-slate-200 space-y-6">
                <div className="flex items-center gap-2 border-b border-slate-100 pb-4 mb-4">
                   <span className="bg-teal-100 text-teal-700 text-xs font-bold px-2 py-0.5 rounded">2</span>
                  <h2 className="text-lg font-bold text-slate-800">{t.headerCurrentEvent}</h2>
                </div>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="space-y-2">
                    <label className="block text-sm font-medium text-slate-700">{t.drugLabel}</label>
                    <input type="text" value={drugName} onChange={(e) => setDrugName(e.target.value)} placeholder={t.drugPlaceholder} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all" />
                  </div>
                  <div className="space-y-2">
                    <label className="block text-sm font-medium text-slate-700">{t.reactionLabel}</label>
                    <input type="text" value={reaction} onChange={(e) => setReaction(e.target.value)} placeholder={t.reactionPlaceholder} className="w-full p-3 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition-all" />
                  </div>
                </div>
              </section>

              <section className="space-y-4">
                <div className="flex items-center justify-between mb-2">
                  <div className="flex items-center gap-2">
                      <span className="bg-slate-200 text-slate-600 text-xs font-bold px-2 py-0.5 rounded">3</span>
                      <h2 className="text-lg font-bold text-slate-800 px-1">{t.questionsHeader}</h2>
                  </div>
                  <span className="text-xs font-medium text-slate-500 bg-slate-200 px-2 py-1 rounded-full">
                    {Object.keys(answers).length} / 10 {t.answered}
                  </span>
                </div>
                {questions.map((q) => (
                  <QuestionItem key={q.id} question={q} currentAnswer={answers[q.id] || null} onAnswer={(id, val) => handleAnswer(id, val)} t={t} />
                ))}
              </section>

              <div className="flex justify-center pt-4 pb-8">
                  {isComplete ? (
                       <button onClick={scrollToResults} className="bg-teal-600 text-white px-8 py-3 rounded-full font-bold shadow-lg shadow-teal-200 hover:bg-teal-700 transition-all transform hover:scale-105">{t.viewResults}</button>
                  ) : (
                      <div className="flex items-center gap-2 text-center text-amber-600 bg-amber-50 px-4 py-2 rounded-lg text-sm font-medium border border-amber-100">
                          <AlertCircle className="h-4 w-4" />{t.completeAll}
                      </div>
                  )}
              </div>

              <div ref={resultsRef} className="scroll-mt-24">
                  {isComplete && (
                      <ResultsSection totalScore={calculateScore} drugName={drugName} reaction={reaction} reportData={reportData} t={t} />
                  )}
              </div>

              <div className="flex justify-center">
                  <button onClick={handleReset} className="flex items-center gap-2 text-slate-500 hover:text-teal-600 transition-colors text-sm font-medium px-4 py-2 rounded-lg hover:bg-slate-100">
                      <RefreshCw className="h-4 w-4" />{t.reset}
                  </button>
              </div>
            </main>
            
            <footer className="bg-white border-t border-slate-200 mt-12 py-8">
              <div className="max-w-4xl mx-auto px-4 text-center space-y-2">
                  <p className="text-slate-400 text-xs">Reference: Naranjo CA, et al. A method for estimating the probability of adverse drug reactions. Clin Pharmacol Ther. 1981;30:239-245.</p>
                  <div className="text-slate-500 text-[10px] sm:text-xs mt-4 leading-relaxed">
                    <p className="font-semibold text-slate-600 mb-1">[Version 20250221 - Local AI: MedGemma]</p>
                    <p>à¸žà¸±à¸’à¸™à¸²à¹‚à¸”à¸¢à¹€à¸ à¸ªà¸±à¸Šà¸à¸£à¸˜à¸™à¸±à¸Žà¸Šà¸² à¸ªà¸­à¸‡à¹€à¸¡à¸·à¸­à¸‡ à¸«à¸±à¸§à¸«à¸™à¹‰à¸²à¸‡à¸²à¸™à¹€à¸ à¸ªà¸±à¸Šà¸à¸£à¸£à¸¡à¸ªà¸²à¸£à¸ªà¸™à¹€à¸—à¸¨ à¹à¸¥à¸°à¸‡à¸²à¸™à¹€à¸ à¸ªà¸±à¸Šà¸à¸£à¸£à¸¡à¸à¸²à¸£à¸œà¸¥à¸´à¸•</p>
                    <p>à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™à¹€à¸ à¸ªà¸±à¸Šà¸à¸£à¸£à¸¡ à¹‚à¸£à¸‡à¸žà¸¢à¸²à¸šà¸²à¸¥à¸§à¸²à¸£à¸´à¸™à¸Šà¸³à¸£à¸²à¸š à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸­à¸¸à¸šà¸¥à¸£à¸²à¸Šà¸˜à¸²à¸™à¸µ</p>
                  </div>
              </div>
            </footer>
          </div>
        );
      };

      // --- RENDER ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>